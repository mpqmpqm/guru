<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sessions | guru</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåÄ</text></svg>"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        overflow: auto;
      }

      .inspect-container {
        max-width: 720px;
        margin: 0 auto;
        padding: 2rem 1rem;
        min-height: 100dvh;
      }

      .inspect-header {
        margin-bottom: 2rem;
      }

      .inspect-header h1 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin: 0 0 0.5rem 0;
      }

      .inspect-header a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.875rem;
      }

      .inspect-header a:hover {
        color: var(--accent-amber);
      }

      .session-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .session-item {
        display: block;
        padding: 1rem;
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.2s ease;
      }

      .session-item:hover {
        background: var(--bg-elevated);
        border-color: var(--accent-amber);
      }

      .session-row {
        display: flex;
        gap: 0.75rem;
        align-items: flex-start;
      }

      .session-content {
        flex: 1;
        min-width: 0;
        text-decoration: none;
      }

      .delete-btn {
        background: transparent;
        border: 1px solid var(--border-subtle);
        color: var(--text-secondary);
        padding: 0.375rem 0.5rem;
        border-radius: 6px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-shrink: 0;
      }

      .delete-btn:hover {
        border-color: var(--accent-error);
        color: var(--accent-error);
      }

      .session-prompt {
        color: var(--text-primary);
        font-size: 0.9375rem;
        margin-bottom: 0.5rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .session-meta {
        color: var(--text-secondary);
        font-size: 0.8125rem;
        display: flex;
        gap: 0.75rem;
      }

      .session-status {
        padding: 0.125rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .session-status.completed {
        background: rgba(107, 143, 113, 0.2);
        color: var(--accent-success);
      }

      .session-status.active {
        background: rgba(212, 168, 83, 0.2);
        color: var(--accent-amber);
      }

      .session-status.closed {
        background: rgba(199, 95, 95, 0.2);
        color: var(--accent-error);
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-secondary);
      }

      .loading {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-secondary);
      }
    </style>
  </head>
  <body>
    <div class="inspect-container">
      <div class="inspect-header">
        <h1>Sessions</h1>
        <a href="/">‚Üê back to guru</a>
      </div>

      <div id="session-list" class="session-list">
        <div class="loading">Loading sessions...</div>
      </div>
    </div>

    <script>
      async function loadSessions() {
        const container = document.getElementById("session-list");

        try {
          const response = await fetch("/api/inspect/sessions");
          const sessions = await response.json();

          if (sessions.length === 0) {
            container.innerHTML =
              '<div class="empty-state">No sessions yet</div>';
            return;
          }

          container.innerHTML = sessions
            .map((session) => {
              const date = new Date(session.created_at);
              const formatted = date.toLocaleDateString("en-US", {
                month: "short",
                day: "numeric",
                hour: "numeric",
                minute: "2-digit",
              });

              const prompt = session.initial_prompt || "(no prompt)";

              return `
              <div class="session-item session-row">
                <a href="/inspect/${session.id}" class="session-content">
                  <div class="session-prompt">${escapeHtml(prompt)}</div>
                  <div class="session-meta">
                    <span>${formatted}</span>
                    <span class="session-status ${session.status}">${session.status}</span>
                  </div>
                </a>
                <button class="delete-btn" onclick="deleteSession('${session.id}', event)">Delete</button>
              </div>
            `;
            })
            .join("");
        } catch (error) {
          container.innerHTML = `<div class="empty-state">Error loading sessions: ${error.message}</div>`;
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      async function deleteSession(sessionId, event) {
        event.stopPropagation();
        if (!confirm("Delete this session?")) return;

        try {
          const response = await fetch(`/api/inspect/sessions/${sessionId}`, {
            method: "DELETE",
          });
          if (response.ok) {
            loadSessions();
          } else {
            alert("Failed to delete session");
          }
        } catch (error) {
          alert("Error deleting session: " + error.message);
        }
      }

      loadSessions();
    </script>
  </body>
</html>
